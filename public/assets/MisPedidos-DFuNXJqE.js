const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-DQazqWYS.js","assets/index-BzdQ1qhZ.js","assets/index-fzd8IgFE.css","assets/jspdf.plugin.autotable-CSDkDfKu.js","assets/_commonjsHelpers-C4iS2aBk.js"])))=>i.map(i=>d[i]);
import{a as se,r as x,y as R,z as re,v as ne,u as de,M as ie,c as v,w as a,A as s,b as e,B as g,l as C,N as ue,O as V,P as ce,o as fe,H as d,d as y,h,D as Q,S as U,j as _,k as i,E as k,n as f,f as r,T as N,U as me,V as ve,W as O,K as E,i as S,X as Y,Y as ge,Z as pe,$ as H,a0 as J,a1 as _e,J as ye,L as be,a2 as K,x as u,C as F}from"./index-BzdQ1qhZ.js";const xe={class:"row justify-center"},Ee={class:"col-12 col-md-10 col-lg-8"},Pe={class:"row justify-center q-pa-md"},we={class:"text-center q-pa-lg"},$e={class:"text-h6 q-mt-md"},Ce={class:"row q-mt-sm"},Ve={class:"col-12 col-sm-6"},ke={class:"col-12 col-sm-6 text-right"},he={class:"text-weight-medium"},De={key:0,class:"q-mt-sm"},qe={class:"text-h6"},Qe={class:"row q-col-gutter-md"},Se={class:"col-12 col-md-6"},Fe={class:"col-12 col-md-6"},Ie={class:"row q-gutter-sm q-mt-sm"},Te={key:0,class:"q-ml-sm"},Ae={class:"text-weight-medium"},Le={class:"text-center q-mb-md"},Ne={__name:"MisPedidos",setup(je){const b=ne(),W=de(),B=se(),I=x(!0),T=x(!1),P=x([]),A=x(!1),L=x(!1),n=x(null),w=x("todos"),D=x({puntuacion:3,comentario:""}),M=R(()=>{if(w.value==="todos")return P.value;const o={pendiente:"Pendiente","en-proceso":"En proceso",enviado:"En camino",entregado:"Entregado",cancelado:"Cancelado"};return P.value.filter(t=>t.estado===o[w.value])}),X=R(()=>w.value==="todos"?"":{pendiente:"pendientes","en-proceso":"en proceso",enviado:"enviados",entregado:"entregados",cancelado:"cancelados"}[w.value]||"");re(async()=>{if(!B.isAuthenticated){localStorage.setItem("redirectAfterLogin","/cliente/pedidos"),b.notify({message:"Debes iniciar sesión para ver tus pedidos",color:"warning",icon:"warning"}),W.push("/login");return}await Z()});const Z=async()=>{var o;I.value=!0;try{let t=[];try{const c=(o=B.usuario)==null?void 0:o._id;if(c){const p=await ie.get(`/api/pedidos/usuario/${c}`);p.data&&Array.isArray(p.data)&&(t=p.data)}}catch(c){console.warn("No se pudieron cargar pedidos desde la API:",c)}const l=JSON.parse(localStorage.getItem("pedidos")||"[]"),$=new Set(t.map(c=>c._id)),q=l.filter(c=>!$.has(c._id));P.value=[...t,...q].sort((c,p)=>new Date(p.fecha)-new Date(c.fecha)),P.value.length}catch(t){console.error("Error al cargar pedidos:",t),b.notify({message:"Error al cargar tus pedidos",color:"negative",icon:"error"})}finally{I.value=!1}},j=o=>{if(!o)return"";const t={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString("es-ES",t)},m=o=>o.toFixed(2),z=o=>{switch(o){case"Entregado":return"positive";case"En camino":return"info";case"En proceso":return"secondary";case"Pendiente":return"warning";case"Cancelado":return"negative";default:return"grey"}},G=o=>{switch(o){case"Pendiente":return .25;case"En proceso":return .5;case"En camino":return .75;case"Entregado":return 1;default:return 0}},ee=o=>{n.value=o,A.value=!0},ae=async o=>{try{P.value=P.value.filter(t=>t.id!==o.id),b.notify({message:"Pedido cancelado exitosamente",color:"positive",icon:"check"})}catch(t){console.error("Error al cancelar el pedido:",t),b.notify({message:"Error al cancelar el pedido",color:"negative",icon:"error"})}},te=async()=>{T.value=!0;try{L.value=!1,b.notify({message:"Valoración enviada exitosamente",color:"positive",icon:"check"})}catch(o){console.error("Error al enviar la valoración:",o),b.notify({message:"Error al enviar la valoración",color:"negative",icon:"error"})}finally{T.value=!1}},le=o=>{try{K(async()=>{const{default:t}=await import("./jspdf.es.min-DQazqWYS.js").then(l=>l.j);return{default:t}},__vite__mapDeps([0,1,2])).then(({default:t})=>{K(()=>import("./jspdf.plugin.autotable-CSDkDfKu.js").then(l=>l.j),__vite__mapDeps([3,4,0,1,2])).then(()=>{const l=new t;l.setFontSize(20),l.text("Factura de Compra",105,15,{align:"center"}),l.setFontSize(12),l.text(`Pedido #: ${o.id}`,14,30),l.text(`Fecha: ${j(o.fecha)}`,14,38),l.text(`Estado: ${o.estado}`,14,46),l.text(`Método de pago: ${o.metodoPago}`,14,54),l.text("Dirección de envío:",14,70),l.text(`${o.direccion.calle}`,14,78),l.text(`${o.direccion.ciudad}, ${o.direccion.estado}`,14,86);const $=["Producto","Cantidad","Precio","Total"],q=[];o.items.forEach(p=>{const oe=[p.nombre,p.cantidad,`$${m(p.precio)}`,`$${m(p.precio*p.cantidad)}`];q.push(oe)}),l.autoTable({head:[$],body:q,startY:100,theme:"striped",headStyles:{fillColor:[41,128,185],textColor:255}});const c=l.lastAutoTable.finalY+10;l.text(`Subtotal: $${m(o.subtotal)}`,130,c,{align:"right"}),o.descuento>0&&l.text(`Descuento: -$${m(o.descuento)}`,130,c+8,{align:"right"}),l.text(`Envío: $${m(o.envio)}`,130,c+16,{align:"right"}),l.text(`Total: $${m(o.total)}`,130,c+24,{align:"right"}),l.setFontSize(10),l.text("Este documento es un comprobante de compra y no tiene validez fiscal.",105,280,{align:"center"}),l.save(`factura_pedido_${o.id}.pdf`),b.notify({message:"Factura descargada correctamente",color:"positive",icon:"check"})})}).catch(t=>{console.error("Error al cargar las librerías de PDF:",t),b.notify({message:"No se pudo generar la factura PDF",color:"negative",icon:"error"})})}catch(t){console.error("Error al generar factura PDF:",t),b.notify({message:"Error al generar la factura",color:"negative",icon:"error"})}};return(o,t)=>(u(),v(be,{padding:""},{default:a(()=>[s("div",xe,[s("div",Ee,[e(E,{class:"q-mb-md"},{default:a(()=>[e(g,null,{default:a(()=>t[7]||(t[7]=[s("div",{class:"text-h5"},"Mis Pedidos",-1),s("div",{class:"text-caption text-grey"},"Historial de tus compras",-1)])),_:1}),e(C),e(ue,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:a(()=>[e(V,{name:"todos",label:"Todos"}),e(V,{name:"pendiente",label:"Pendientes"}),e(V,{name:"en-proceso",label:"En Proceso"}),e(V,{name:"enviado",label:"Enviados"}),e(V,{name:"entregado",label:"Entregados"}),e(V,{name:"cancelado",label:"Cancelados"})]),_:1},8,["modelValue"]),e(C),I.value?(u(),v(g,{key:0},{default:a(()=>[s("div",Pe,[e(ce,{color:"primary",size:"3em"})])]),_:1})):M.value.length===0?(u(),v(g,{key:1},{default:a(()=>[s("div",we,[e(fe,{name:"shopping_bag",size:"4em",color:"grey-5"}),s("div",$e,"No tienes pedidos "+d(X.value),1),t[8]||(t[8]=s("div",{class:"text-body2 text-grey q-mt-sm"}," Cuando realices una compra, tus pedidos aparecerán aquí. ",-1)),e(y,{color:"primary",label:"Ir a la tienda",class:"q-mt-md",to:"/",icon:"shopping_cart"})])]),_:1})):(u(),v(g,{key:2},{default:a(()=>[e(h,{separator:""},{default:a(()=>[(u(!0),Q(O,null,U(M.value,l=>(u(),v(_,{key:l.id,clickable:"",onClick:$=>ee(l),class:"q-py-md"},{default:a(()=>[e(i,null,{default:a(()=>[e(f,{class:"text-subtitle1"},{default:a(()=>[r(" Pedido #"+d(l.id),1)]),_:2},1024),e(f,{caption:""},{default:a(()=>[r(d(j(l.fecha)),1)]),_:2},1024),s("div",Ce,[s("div",Ve,[e(N,{color:z(l.estado)},{default:a(()=>[r(d(l.estado),1)]),_:2},1032,["color"])]),s("div",ke,[s("span",he," $"+d(m(l.total)),1)])]),l.estado!=="Cancelado"?(u(),Q("div",De,[e(me,{value:G(l.estado),color:z(l.estado),class:"q-mt-xs"},null,8,["value","color"])])):k("",!0)]),_:2},1024),e(i,{side:""},{default:a(()=>[e(y,{flat:"",round:"",color:"primary",icon:"visibility"},{default:a(()=>[e(ve,null,{default:a(()=>t[9]||(t[9]=[r("Ver detalles")])),_:1})]),_:1})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}))]),_:1})])]),e(J,{modelValue:A.value,"onUpdate:modelValue":t[3]||(t[3]=l=>A.value=l),maximized:""},{default:a(()=>[e(E,null,{default:a(()=>[e(g,{class:"row items-center"},{default:a(()=>{var l;return[s("div",qe,"Detalles del Pedido #"+d((l=n.value)==null?void 0:l.id),1),e(Y),S(e(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]}),_:1}),e(C),n.value?(u(),v(g,{key:0},{default:a(()=>[s("div",Qe,[s("div",Se,[e(E,{flat:"",bordered:""},{default:a(()=>[e(g,null,{default:a(()=>[t[14]||(t[14]=s("div",{class:"text-subtitle1"},"Información del Pedido",-1)),e(h,{dense:""},{default:a(()=>{var l;return[e(_,null,{default:a(()=>[e(i,null,{default:a(()=>[e(f,{caption:""},{default:a(()=>t[10]||(t[10]=[r("Fecha")])),_:1}),e(f,null,{default:a(()=>[r(d(j(n.value.fecha)),1)]),_:1})]),_:1})]),_:1}),e(_,null,{default:a(()=>[e(i,null,{default:a(()=>[e(f,{caption:""},{default:a(()=>t[11]||(t[11]=[r("Estado")])),_:1}),e(f,null,{default:a(()=>[e(N,{color:z(n.value.estado)},{default:a(()=>[r(d(n.value.estado),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),e(_,null,{default:a(()=>[e(i,null,{default:a(()=>[e(f,{caption:""},{default:a(()=>t[12]||(t[12]=[r("Método de pago")])),_:1}),e(f,null,{default:a(()=>[r(d(n.value.metodoPago),1)]),_:1})]),_:1})]),_:1}),(l=n.value.detallesPago)!=null&&l.idTransaccion?(u(),v(_,{key:0},{default:a(()=>[e(i,null,{default:a(()=>[e(f,{caption:""},{default:a(()=>t[13]||(t[13]=[r("ID de Transacción")])),_:1}),e(f,null,{default:a(()=>[r(d(n.value.detallesPago.idTransaccion),1)]),_:1})]),_:1})]),_:1})):k("",!0)]}),_:1})]),_:1})]),_:1}),e(E,{flat:"",bordered:"",class:"q-mt-md"},{default:a(()=>[e(g,null,{default:a(()=>[t[15]||(t[15]=s("div",{class:"text-subtitle1"},"Dirección de Envío",-1)),e(h,{dense:""},{default:a(()=>[e(_,null,{default:a(()=>[e(i,null,{default:a(()=>[e(f,null,{default:a(()=>[r(d(n.value.direccion.calle),1)]),_:1}),e(f,{caption:""},{default:a(()=>[r(d(n.value.direccion.ciudad)+", "+d(n.value.direccion.estado),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",Fe,[e(E,{flat:"",bordered:""},{default:a(()=>[e(g,null,{default:a(()=>[t[20]||(t[20]=s("div",{class:"text-subtitle1"},"Resumen",-1)),e(h,{dense:""},{default:a(()=>[e(_,null,{default:a(()=>[e(i,null,{default:a(()=>t[16]||(t[16]=[r("Subtotal")])),_:1}),e(i,{side:""},{default:a(()=>[r("$"+d(m(n.value.subtotal)),1)]),_:1})]),_:1}),n.value.descuento>0?(u(),v(_,{key:0},{default:a(()=>[e(i,null,{default:a(()=>t[17]||(t[17]=[r("Descuento")])),_:1}),e(i,{side:"",class:"text-negative"},{default:a(()=>[r("-$"+d(m(n.value.descuento)),1)]),_:1})]),_:1})):k("",!0),e(_,null,{default:a(()=>[e(i,null,{default:a(()=>t[18]||(t[18]=[r("Envío")])),_:1}),e(i,{side:""},{default:a(()=>[r("$"+d(m(n.value.envio)),1)]),_:1})]),_:1}),e(C,{class:"q-my-sm"}),e(_,null,{default:a(()=>[e(i,{class:"text-weight-bold"},{default:a(()=>t[19]||(t[19]=[r("Total")])),_:1}),e(i,{side:"",class:"text-weight-bold"},{default:a(()=>[r("$"+d(m(n.value.total)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(E,{flat:"",bordered:"",class:"q-mt-md"},{default:a(()=>[e(g,null,{default:a(()=>[t[21]||(t[21]=s("div",{class:"text-subtitle1"},"Acciones",-1)),s("div",Ie,[e(y,{color:"primary",icon:"receipt",label:"Descargar Factura",onClick:t[1]||(t[1]=l=>le(n.value))}),n.value.estado==="Pendiente"?(u(),v(y,{key:0,color:"negative",icon:"cancel",label:"Cancelar Pedido",onClick:t[2]||(t[2]=l=>ae(n.value))})):k("",!0)])]),_:1})]),_:1})])]),e(C,{class:"q-my-md"}),t[23]||(t[23]=s("div",{class:"text-subtitle1 q-mb-sm"},"Productos",-1)),e(h,{separator:""},{default:a(()=>[(u(!0),Q(O,null,U(n.value.items,(l,$)=>(u(),v(_,{key:$},{default:a(()=>[e(i,{avatar:""},{default:a(()=>[e(ge,{src:l.imagen,"spinner-color":"primary",style:{height:"60px",width:"60px"},class:"rounded-borders"},null,8,["src"])]),_:2},1024),e(i,null,{default:a(()=>[e(f,null,{default:a(()=>[r(d(l.nombre),1)]),_:2},1024),e(f,{caption:""},{default:a(()=>[r(" Cantidad: "+d(l.cantidad)+" ",1),l.color?(u(),Q("span",Te,[t[22]||(t[22]=r(" Color: ")),e(N,{style:pe(`background-color: ${l.color}`)},null,8,["style"])])):k("",!0)]),_:2},1024)]),_:2},1024),e(i,{side:""},{default:a(()=>[s("div",Ae," $"+d(m(l.precio*l.cantidad)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):k("",!0),e(H,{align:"right"},{default:a(()=>[S(e(y,{flat:"",label:"Cerrar",color:"primary"},null,512),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:L.value,"onUpdate:modelValue":t[6]||(t[6]=l=>L.value=l)},{default:a(()=>[e(E,{style:{width:"500px","max-width":"90vw"}},{default:a(()=>[e(g,{class:"row items-center"},{default:a(()=>[t[24]||(t[24]=s("div",{class:"text-h6"},"Valorar tu compra",-1)),e(Y),S(e(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]),_:1}),e(C),e(g,null,{default:a(()=>[s("div",Le,[t[25]||(t[25]=s("div",{class:"text-subtitle1 q-mb-sm"},"¿Cómo calificarías tu experiencia?",-1)),e(_e,{modelValue:D.value.puntuacion,"onUpdate:modelValue":t[4]||(t[4]=l=>D.value.puntuacion=l),size:"3em",color:"amber",icon:"star_border","icon-selected":"star",max:5},null,8,["modelValue"])]),e(ye,{modelValue:D.value.comentario,"onUpdate:modelValue":t[5]||(t[5]=l=>D.value.comentario=l),label:"Comparte tu opinión (opcional)",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),e(H,{align:"right"},{default:a(()=>[S(e(y,{flat:"",label:"Cancelar",color:"grey"},null,512),[[F]]),T.value?(u(),v(y,{key:1,label:"Enviando...",color:"primary",disable:""})):(u(),v(y,{key:0,flat:"",label:"Enviar valoración",color:"primary",onClick:te}))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ne as default};

import{a as G,y as V,r as v,z as X,v as Z,S as C,c as x,w as t,B as s,b as e,E as m,l as S,V as Y,o as H,d as u,h as B,j as k,k as f,n as _,f as d,X as R,N as c,A as J,L as K,$ as O,a1 as A,Z as I,K as W,D,i as h,J as ee,G as ae,H as te,P as L,F as le,O as oe,I as se,x as g,C as E}from"./index-DVpeUCJe.js";const re={class:"row justify-center"},ie={class:"col-12 col-md-10 col-lg-8"},ne={class:"row justify-center q-pa-md"},de={class:"text-center q-pa-lg"},ue={class:"row q-col-gutter-md"},ce={class:"col-12 col-md-6"},me={class:"q-mt-sm"},fe={class:"q-mt-sm text-caption text-grey"},pe={class:"column items-center q-gutter-y-sm"},ve={class:"text-subtitle1 q-mb-sm"},ge={class:"q-mb-md"},ye={class:"row justify-end q-mt-md"},be={__name:"MisResenas",setup(xe){const p=Z(),P=G(),b=V(()=>P.usuario),Q=v(!0),i=v([]),w=v(!1),q=v(!1),r=v({}),y=v(null),j=V(()=>i.value.length),z=V(()=>i.value.reduce((o,a)=>o+(a.utilidad||0),0));X(async()=>{if(!b.value){p.notify({message:"Debes iniciar sesión para ver tus reseñas",color:"warning",icon:"warning"});return}await T()});const T=async()=>{var o;Q.value=!0;try{const a=await C.get(`/api/usuarios/${(o=b.value)==null?void 0:o._id}/resenas`);a.data&&a.data.resenas&&Array.isArray(a.data.resenas)?(i.value=a.data.resenas.map(l=>({id:l._id,producto:{id:l.producto._id,nombre:l.producto.nombre,imagen:l.producto.imagen},calificacion:l.calificacion,texto:l.texto,fecha:new Date(l.fecha),utilidad:0})),console.log(`Cargadas ${a.data.resenas.length} reseñas del usuario`)):(await new Promise(l=>setTimeout(l,1e3)),i.value=[{id:"1",producto:{id:"101",nombre:"Smartphone XYZ Pro",imagen:"https://cdn.quasar.dev/img/mountains.jpg"},calificacion:4,texto:"Excelente teléfono, la batería dura todo el día y la cámara es increíble. Lo recomiendo totalmente.",fecha:new Date(2023,8,15),utilidad:3},{id:"2",producto:{id:"102",nombre:"Auriculares Bluetooth ABC",imagen:"https://cdn.quasar.dev/img/parallax2.jpg"},calificacion:5,texto:"La calidad de sonido es impresionante y la cancelación de ruido funciona perfectamente. Muy cómodos para usar durante horas.",fecha:new Date(2023,9,5),utilidad:7}])}catch(a){console.error("Error al cargar reseñas:",a),i.value=[{id:"1",producto:{id:"101",nombre:"Smartphone XYZ Pro",imagen:"https://cdn.quasar.dev/img/mountains.jpg"},calificacion:4,texto:"Excelente teléfono, la batería dura todo el día y la cámara es increíble. Lo recomiendo totalmente.",fecha:new Date(2023,8,15),utilidad:3},{id:"2",producto:{id:"102",nombre:"Auriculares Bluetooth ABC",imagen:"https://cdn.quasar.dev/img/parallax2.jpg"},calificacion:5,texto:"La calidad de sonido es impresionante y la cancelación de ruido funciona perfectamente. Muy cómodos para usar durante horas.",fecha:new Date(2023,9,5),utilidad:7}],p.notify({message:"Error al cargar tus reseñas",color:"negative",icon:"error"})}finally{Q.value=!1}},$=o=>{if(!o)return"";const a={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString("es-ES",a)},U=o=>{r.value={...o},w.value=!0},M=async()=>{try{b.value&&r.value.id?await C.put(`/api/resenas/${r.value.id}`,{calificacion:r.value.calificacion,texto:r.value.texto}):await new Promise(a=>setTimeout(a,500));const o=i.value.findIndex(a=>a.id===r.value.id);o!==-1&&(i.value[o]={...r.value}),w.value=!1,p.notify({message:"Reseña actualizada correctamente",color:"positive",icon:"check_circle"})}catch(o){console.error("Error al actualizar reseña:",o),p.notify({message:"Error al actualizar la reseña",color:"negative",icon:"error"})}},N=o=>{y.value=o,q.value=!0},F=async()=>{try{b.value&&y.value.id?await C.delete(`/api/resenas/${y.value.id}`):await new Promise(o=>setTimeout(o,500)),i.value=i.value.filter(o=>o.id!==y.value.id),p.notify({message:"Reseña eliminada correctamente",color:"positive",icon:"check_circle"}),q.value=!1,y.value=null}catch(o){console.error("Error al eliminar reseña:",o),p.notify({message:"Error al eliminar la reseña",color:"negative",icon:"error"})}};return(o,a)=>(g(),x(se,{padding:""},{default:t(()=>[s("div",re,[s("div",ie,[e(D,{class:"q-mb-md"},{default:t(()=>[e(m,null,{default:t(()=>a[4]||(a[4]=[s("div",{class:"text-h5"},"Mis Reseñas",-1),s("div",{class:"text-caption text-grey"},"Gestiona tus valoraciones de productos",-1)])),_:1}),e(S),Q.value?(g(),x(m,{key:0},{default:t(()=>[s("div",ne,[e(Y,{color:"primary",size:"3em"})])]),_:1})):i.value.length===0?(g(),x(m,{key:1},{default:t(()=>[s("div",de,[e(H,{name:"rate_review",size:"4em",color:"grey-5"}),a[5]||(a[5]=s("div",{class:"text-h6 q-mt-md"},"No has escrito reseñas todavía",-1)),a[6]||(a[6]=s("div",{class:"text-body2 text-grey q-mt-sm"}," Después de recibir tus pedidos, podrás valorar los productos que has comprado. ",-1)),e(u,{color:"primary",label:"Ir a la tienda",class:"q-mt-md",to:"/",icon:"shopping_cart"})])]),_:1})):(g(),x(m,{key:2},{default:t(()=>[s("div",ue,[s("div",ce,[a[9]||(a[9]=s("div",{class:"text-subtitle1 q-mb-sm"},"Resumen",-1)),e(B,{bordered:"",separator:"",class:"rounded-borders"},{default:t(()=>[e(k,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,null,{default:t(()=>a[7]||(a[7]=[d("Total de reseñas")])),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(R,{color:"primary","text-color":"white"},{default:t(()=>[d(c(j.value),1)]),_:1})]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,null,{default:t(()=>a[8]||(a[8]=[d("Reseñas útiles para otros")])),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(R,{color:"positive","text-color":"white"},{default:t(()=>[d(c(z.value),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),a[12]||(a[12]=s("div",{class:"text-subtitle1 q-mt-lg q-mb-sm"},"Mis valoraciones",-1)),e(B,{separator:""},{default:t(()=>[(g(!0),J(W,null,K(i.value,l=>(g(),x(k,{key:l.id,class:"q-py-md"},{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(O,{src:l.producto.imagen,"spinner-color":"primary",style:{height:"80px",width:"80px"},class:"rounded-borders"},null,8,["src"])]),_:2},1024),e(f,null,{default:t(()=>[e(_,{class:"text-subtitle1"},{default:t(()=>[d(c(l.producto.nombre),1)]),_:2},1024),e(_,{caption:""},{default:t(()=>[d(c($(l.fecha)),1)]),_:2},1024),s("div",me,[e(A,{modelValue:l.calificacion,"onUpdate:modelValue":n=>l.calificacion=n,size:"1.5em",color:"amber",readonly:"",max:5},null,8,["modelValue","onUpdate:modelValue"])]),e(_,{class:"q-mt-sm"},{default:t(()=>[d(c(l.texto),1)]),_:2},1024),s("div",fe,c(l.utilidad)+" "+c(l.utilidad===1?"persona encontró":"personas encontraron")+" útil esta reseña ",1)]),_:2},1024),e(f,{side:""},{default:t(()=>[s("div",pe,[e(u,{flat:"",round:"",color:"primary",icon:"edit",onClick:n=>U(l)},{default:t(()=>[e(I,null,{default:t(()=>a[10]||(a[10]=[d("Editar reseña")])),_:1})]),_:2},1032,["onClick"]),e(u,{flat:"",round:"",color:"negative",icon:"delete",onClick:n=>N(l)},{default:t(()=>[e(I,null,{default:t(()=>a[11]||(a[11]=[d("Eliminar reseña")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1})])]),e(L,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=l=>w.value=l)},{default:t(()=>[e(D,{style:{width:"500px","max-width":"90vw"}},{default:t(()=>[e(m,{class:"row items-center"},{default:t(()=>[a[13]||(a[13]=s("div",{class:"text-h6"},"Editar reseña",-1)),e(ee),h(e(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[E]])]),_:1}),e(S),e(m,null,{default:t(()=>{var l;return[s("div",ve,c((l=r.value.producto)==null?void 0:l.nombre),1),e(ae,{onSubmit:M},{default:t(()=>[s("div",ge,[a[14]||(a[14]=s("div",{class:"text-subtitle2 q-mb-sm"},"Tu calificación",-1)),e(A,{modelValue:r.value.calificacion,"onUpdate:modelValue":a[0]||(a[0]=n=>r.value.calificacion=n),size:"2em",color:"amber",icon:"star_border","icon-selected":"star",max:5},null,8,["modelValue"])]),e(te,{modelValue:r.value.texto,"onUpdate:modelValue":a[1]||(a[1]=n=>r.value.texto=n),label:"Tu reseña",type:"textarea",rows:"4",outlined:"",rules:[n=>!!n||"Por favor escribe una reseña"]},null,8,["modelValue","rules"]),s("div",ye,[h(e(u,{label:"Cancelar",color:"grey",flat:""},null,512),[[E]]),e(u,{label:"Guardar",type:"submit",color:"primary",class:"q-ml-sm"})])]),_:1})]}),_:1})]),_:1})]),_:1},8,["modelValue"]),e(L,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=l=>q.value=l)},{default:t(()=>[e(D,null,{default:t(()=>[e(m,{class:"row items-center"},{default:t(()=>[e(le,{icon:"delete",color:"negative","text-color":"white"}),a[15]||(a[15]=s("span",{class:"q-ml-sm"},"¿Estás seguro de que deseas eliminar esta reseña?",-1))]),_:1}),e(oe,{align:"right"},{default:t(()=>[h(e(u,{flat:"",label:"Cancelar",color:"primary"},null,512),[[E]]),h(e(u,{flat:"",label:"Eliminar",color:"negative",onClick:F},null,512),[[E]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{be as default};

import{a as X,y as V,r as p,z as Y,v as G,M as C,c as x,w as t,A as o,b as e,B as m,l as D,P as Z,o as H,d as u,h as B,j as k,k as f,n as _,f as d,T as R,H as c,D as J,S as K,Y as W,a1 as A,V as I,W as O,K as S,i as h,X as ee,I as ae,J as te,a0 as L,F as le,$ as oe,L as se,x as g,C as Q}from"./index-Dp0mp6Bs.js";const re={class:"row justify-center"},ie={class:"col-12 col-md-10 col-lg-8"},ne={class:"row justify-center q-pa-md"},de={class:"text-center q-pa-lg"},ue={class:"row q-col-gutter-md"},ce={class:"col-12 col-md-6"},me={class:"q-mt-sm"},fe={class:"q-mt-sm text-caption text-grey"},ve={class:"column items-center q-gutter-y-sm"},pe={class:"text-subtitle1 q-mb-sm"},ge={class:"q-mb-md"},ye={class:"row justify-end q-mt-md"},be={__name:"MisResenas",setup(xe){const v=G(),P=X(),b=V(()=>P.usuario),E=p(!0),i=p([]),w=p(!1),q=p(!1),r=p({}),y=p(null),T=V(()=>i.value.length),j=V(()=>i.value.reduce((l,a)=>l+(a.utilidad||0),0));Y(async()=>{if(!b.value){v.notify({message:"Debes iniciar sesión para ver tus reseñas",color:"warning",icon:"warning"});return}await z()});const z=async()=>{var l;E.value=!0;try{const a=await C.get(`/api/usuarios/${(l=b.value)==null?void 0:l._id}/resenas`);a.data&&Array.isArray(a.data)?i.value=a.data:(await new Promise(s=>setTimeout(s,1e3)),i.value=[{id:"1",producto:{id:"101",nombre:"Smartphone XYZ Pro",imagen:"https://cdn.quasar.dev/img/mountains.jpg"},calificacion:4,texto:"Excelente teléfono, la batería dura todo el día y la cámara es increíble. Lo recomiendo totalmente.",fecha:new Date(2023,8,15),utilidad:3},{id:"2",producto:{id:"102",nombre:"Auriculares Bluetooth ABC",imagen:"https://cdn.quasar.dev/img/parallax2.jpg"},calificacion:5,texto:"La calidad de sonido es impresionante y la cancelación de ruido funciona perfectamente. Muy cómodos para usar durante horas.",fecha:new Date(2023,9,5),utilidad:7}])}catch(a){console.error("Error al cargar reseñas:",a),i.value=[{id:"1",producto:{id:"101",nombre:"Smartphone XYZ Pro",imagen:"https://cdn.quasar.dev/img/mountains.jpg"},calificacion:4,texto:"Excelente teléfono, la batería dura todo el día y la cámara es increíble. Lo recomiendo totalmente.",fecha:new Date(2023,8,15),utilidad:3},{id:"2",producto:{id:"102",nombre:"Auriculares Bluetooth ABC",imagen:"https://cdn.quasar.dev/img/parallax2.jpg"},calificacion:5,texto:"La calidad de sonido es impresionante y la cancelación de ruido funciona perfectamente. Muy cómodos para usar durante horas.",fecha:new Date(2023,9,5),utilidad:7}],v.notify({message:"Error al cargar tus reseñas",color:"negative",icon:"error"})}finally{E.value=!1}},M=l=>{if(!l)return"";const a={year:"numeric",month:"long",day:"numeric"};return new Date(l).toLocaleDateString("es-ES",a)},U=l=>{r.value={...l},w.value=!0},$=async()=>{try{b.value&&r.value.id?await C.put(`/api/resenas/${r.value.id}`,{calificacion:r.value.calificacion,texto:r.value.texto}):await new Promise(a=>setTimeout(a,500));const l=i.value.findIndex(a=>a.id===r.value.id);l!==-1&&(i.value[l]={...r.value}),w.value=!1,v.notify({message:"Reseña actualizada correctamente",color:"positive",icon:"check_circle"})}catch(l){console.error("Error al actualizar reseña:",l),v.notify({message:"Error al actualizar la reseña",color:"negative",icon:"error"})}},F=l=>{y.value=l,q.value=!0},N=async()=>{try{b.value&&y.value.id?await C.delete(`/api/resenas/${y.value.id}`):await new Promise(l=>setTimeout(l,500)),i.value=i.value.filter(l=>l.id!==y.value.id),v.notify({message:"Reseña eliminada correctamente",color:"positive",icon:"check_circle"}),q.value=!1,y.value=null}catch(l){console.error("Error al eliminar reseña:",l),v.notify({message:"Error al eliminar la reseña",color:"negative",icon:"error"})}};return(l,a)=>(g(),x(se,{padding:""},{default:t(()=>[o("div",re,[o("div",ie,[e(S,{class:"q-mb-md"},{default:t(()=>[e(m,null,{default:t(()=>a[4]||(a[4]=[o("div",{class:"text-h5"},"Mis Reseñas",-1),o("div",{class:"text-caption text-grey"},"Gestiona tus valoraciones de productos",-1)])),_:1}),e(D),E.value?(g(),x(m,{key:0},{default:t(()=>[o("div",ne,[e(Z,{color:"primary",size:"3em"})])]),_:1})):i.value.length===0?(g(),x(m,{key:1},{default:t(()=>[o("div",de,[e(H,{name:"rate_review",size:"4em",color:"grey-5"}),a[5]||(a[5]=o("div",{class:"text-h6 q-mt-md"},"No has escrito reseñas todavía",-1)),a[6]||(a[6]=o("div",{class:"text-body2 text-grey q-mt-sm"}," Después de recibir tus pedidos, podrás valorar los productos que has comprado. ",-1)),e(u,{color:"primary",label:"Ir a la tienda",class:"q-mt-md",to:"/",icon:"shopping_cart"})])]),_:1})):(g(),x(m,{key:2},{default:t(()=>[o("div",ue,[o("div",ce,[a[9]||(a[9]=o("div",{class:"text-subtitle1 q-mb-sm"},"Resumen",-1)),e(B,{bordered:"",separator:"",class:"rounded-borders"},{default:t(()=>[e(k,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,null,{default:t(()=>a[7]||(a[7]=[d("Total de reseñas")])),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(R,{color:"primary","text-color":"white"},{default:t(()=>[d(c(T.value),1)]),_:1})]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,null,{default:t(()=>a[8]||(a[8]=[d("Reseñas útiles para otros")])),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(R,{color:"positive","text-color":"white"},{default:t(()=>[d(c(j.value),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),a[12]||(a[12]=o("div",{class:"text-subtitle1 q-mt-lg q-mb-sm"},"Mis valoraciones",-1)),e(B,{separator:""},{default:t(()=>[(g(!0),J(O,null,K(i.value,s=>(g(),x(k,{key:s.id,class:"q-py-md"},{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(W,{src:s.producto.imagen,"spinner-color":"primary",style:{height:"80px",width:"80px"},class:"rounded-borders"},null,8,["src"])]),_:2},1024),e(f,null,{default:t(()=>[e(_,{class:"text-subtitle1"},{default:t(()=>[d(c(s.producto.nombre),1)]),_:2},1024),e(_,{caption:""},{default:t(()=>[d(c(M(s.fecha)),1)]),_:2},1024),o("div",me,[e(A,{modelValue:s.calificacion,"onUpdate:modelValue":n=>s.calificacion=n,size:"1.5em",color:"amber",readonly:"",max:5},null,8,["modelValue","onUpdate:modelValue"])]),e(_,{class:"q-mt-sm"},{default:t(()=>[d(c(s.texto),1)]),_:2},1024),o("div",fe,c(s.utilidad)+" "+c(s.utilidad===1?"persona encontró":"personas encontraron")+" útil esta reseña ",1)]),_:2},1024),e(f,{side:""},{default:t(()=>[o("div",ve,[e(u,{flat:"",round:"",color:"primary",icon:"edit",onClick:n=>U(s)},{default:t(()=>[e(I,null,{default:t(()=>a[10]||(a[10]=[d("Editar reseña")])),_:1})]),_:2},1032,["onClick"]),e(u,{flat:"",round:"",color:"negative",icon:"delete",onClick:n=>F(s)},{default:t(()=>[e(I,null,{default:t(()=>a[11]||(a[11]=[d("Eliminar reseña")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1})])]),e(L,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=s=>w.value=s)},{default:t(()=>[e(S,{style:{width:"500px","max-width":"90vw"}},{default:t(()=>[e(m,{class:"row items-center"},{default:t(()=>[a[13]||(a[13]=o("div",{class:"text-h6"},"Editar reseña",-1)),e(ee),h(e(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[Q]])]),_:1}),e(D),e(m,null,{default:t(()=>{var s;return[o("div",pe,c((s=r.value.producto)==null?void 0:s.nombre),1),e(ae,{onSubmit:$},{default:t(()=>[o("div",ge,[a[14]||(a[14]=o("div",{class:"text-subtitle2 q-mb-sm"},"Tu calificación",-1)),e(A,{modelValue:r.value.calificacion,"onUpdate:modelValue":a[0]||(a[0]=n=>r.value.calificacion=n),size:"2em",color:"amber",icon:"star_border","icon-selected":"star",max:5},null,8,["modelValue"])]),e(te,{modelValue:r.value.texto,"onUpdate:modelValue":a[1]||(a[1]=n=>r.value.texto=n),label:"Tu reseña",type:"textarea",rows:"4",outlined:"",rules:[n=>!!n||"Por favor escribe una reseña"]},null,8,["modelValue","rules"]),o("div",ye,[h(e(u,{label:"Cancelar",color:"grey",flat:""},null,512),[[Q]]),e(u,{label:"Guardar",type:"submit",color:"primary",class:"q-ml-sm"})])]),_:1})]}),_:1})]),_:1})]),_:1},8,["modelValue"]),e(L,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=s=>q.value=s)},{default:t(()=>[e(S,null,{default:t(()=>[e(m,{class:"row items-center"},{default:t(()=>[e(le,{icon:"delete",color:"negative","text-color":"white"}),a[15]||(a[15]=o("span",{class:"q-ml-sm"},"¿Estás seguro de que deseas eliminar esta reseña?",-1))]),_:1}),e(oe,{align:"right"},{default:t(()=>[h(e(u,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Q]]),h(e(u,{flat:"",label:"Eliminar",color:"negative",onClick:N},null,512),[[Q]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{be as default};

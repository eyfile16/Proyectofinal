const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-Dm4eDZSB.js","assets/index-yZ2UE3Bh.js","assets/index-CBSngWK0.css","assets/jspdf.plugin.autotable-DZZmldET.js","assets/_commonjsHelpers-C4iS2aBk.js"])))=>i.map(i=>d[i]);
import{_ as re,y as ne,r as k,a as B,s as de,R as ie,P as ue,W as ce,ac as ve,z as v,A as o,Y as n,B as a,$ as x,I as h,C as m,a8 as S,D as r,a1 as _,ad as C,a9 as d,ae as fe,L as me,F as V,X as L,a7 as Y,G as w,H as f,K as g,af as ge,ag as pe,a6 as G,Z as q,v as F,a5 as H,ah as ye,ai as xe,aa as J,ab as K,aj as _e,a3 as we,a4 as be,ak as W,S as i,U as z}from"./index-yZ2UE3Bh.js";const Ee={class:"row justify-center"},Ce={class:"col-12 col-md-10 col-lg-8"},Pe={class:"row q-pa-md q-gutter-sm"},ke={class:"row justify-center q-pa-md"},$e={class:"text-center q-pa-lg"},qe={class:"text-h6 q-mt-md"},De={class:"row q-mt-sm"},he={class:"col-12 col-sm-6"},Se={class:"col-12 col-sm-6 text-right"},Ve={class:"text-weight-medium"},Ie={key:0,class:"q-mt-sm"},Qe={class:"text-h6"},Le={class:"row q-col-gutter-md"},Fe={class:"col-12 col-md-6"},ze={class:"col-12 col-md-6"},Ae={class:"row q-gutter-sm q-mt-sm"},Ne={key:0,class:"q-ml-sm"},Te={class:"text-weight-medium"},je={class:"text-center q-mb-md"},Oe={__name:"MisPedidos",setup(Re){const b=ie(),X=ue(),A=ne(),N=k(!0),T=k(!1),E=k([]),j=k(!1),O=k(!1),u=k(null),s=k("todos"),I=k({puntuacion:3,comentario:""}),U=B(()=>{if(s.value==="todos")return E.value;const e={pendiente:["Pendiente","pendiente"],"en-proceso":["En proceso","En Proceso","procesando"],enviado:["En camino","Enviado","enviado"],entregado:["Entregado","entregado"],cancelado:["Cancelado","cancelado"]}[s.value]||[];return E.value.filter(t=>e.some(P=>t.estado.toLowerCase()===P.toLowerCase()))}),p=B(()=>{const l={todos:E.value.length,pendiente:0,enProceso:0,enviado:0,entregado:0,cancelado:0};return E.value.forEach(e=>{const t=e.estado.toLowerCase();t.includes("pendiente")?l.pendiente++:t.includes("proceso")||t.includes("procesando")?l.enProceso++:t.includes("camino")||t.includes("enviado")?l.enviado++:t.includes("entregado")?l.entregado++:t.includes("cancelado")&&l.cancelado++}),l}),Z=B(()=>s.value==="todos"?"":{pendiente:"pendientes","en-proceso":"en proceso",enviado:"enviados",entregado:"entregados",cancelado:"cancelados"}[s.value]||"");de(async()=>{if(!A.isAuthenticated){localStorage.setItem("redirectAfterLogin","/cliente/pedidos"),b.notify({message:"Debes iniciar sesión para ver tus pedidos",color:"warning",icon:"warning"}),X.push("/login");return}await ee()});const ee=async()=>{var l,e;N.value=!0;try{let t=[];try{const c=(l=A.usuario)==null?void 0:l._id;if(c){const $=await ce.get(`/api/pedidos/usuario/${c}`);$.data&&Array.isArray($.data)&&(t=$.data)}}catch(c){console.warn("No se pudieron cargar pedidos desde la API:",c)}const P=JSON.parse(localStorage.getItem("pedidos")||"[]"),Q=new Set(t.map(c=>c._id)),D=P.filter(c=>!Q.has(c._id));if(E.value=[...t,...D].sort((c,$)=>new Date($.fecha)-new Date(c.fecha)),E.value.length===0){console.log("No hay pedidos, generando datos de ejemplo");const c=((e=A.usuario)==null?void 0:e._id)||"usuario_demo";E.value=ve(c)}}catch(t){console.error("Error al cargar pedidos:",t),b.notify({message:"Error al cargar tus pedidos",color:"negative",icon:"error"})}finally{N.value=!1}},R=l=>{if(!l)return"";const e={year:"numeric",month:"long",day:"numeric"};return new Date(l).toLocaleDateString("es-ES",e)},y=l=>l.toFixed(2),M=l=>{const e=l.toLowerCase();return e.includes("entregado")?"positive":e.includes("camino")||e.includes("enviado")?"info":e.includes("proceso")||e.includes("procesando")?"secondary":e.includes("pendiente")?"warning":e.includes("cancelado")?"negative":"grey"},ae=l=>{const e=l.toLowerCase();return e.includes("entregado")?1:e.includes("camino")||e.includes("enviado")?.75:e.includes("proceso")||e.includes("procesando")?.5:e.includes("pendiente")?.25:0},oe=l=>{u.value=l,j.value=!0},te=async l=>{try{E.value=E.value.filter(e=>e.id!==l.id),b.notify({message:"Pedido cancelado exitosamente",color:"positive",icon:"check"})}catch(e){console.error("Error al cancelar el pedido:",e),b.notify({message:"Error al cancelar el pedido",color:"negative",icon:"error"})}},le=async()=>{T.value=!0;try{O.value=!1,b.notify({message:"Valoración enviada exitosamente",color:"positive",icon:"check"})}catch(l){console.error("Error al enviar la valoración:",l),b.notify({message:"Error al enviar la valoración",color:"negative",icon:"error"})}finally{T.value=!1}},se=l=>{try{W(async()=>{const{default:e}=await import("./jspdf.es.min-Dm4eDZSB.js").then(t=>t.j);return{default:e}},__vite__mapDeps([0,1,2])).then(({default:e})=>{W(()=>import("./jspdf.plugin.autotable-DZZmldET.js").then(t=>t.j),__vite__mapDeps([3,4,0,1,2])).then(()=>{const t=new e;t.setFontSize(20),t.text("Factura de Compra",105,15,{align:"center"}),t.setFontSize(12),t.text(`Pedido #: ${l.id}`,14,30),t.text(`Fecha: ${R(l.fecha)}`,14,38),t.text(`Estado: ${l.estado}`,14,46),t.text(`Método de pago: ${l.metodoPago}`,14,54),t.text("Dirección de envío:",14,70),t.text(`${l.direccion.calle}`,14,78),t.text(`${l.direccion.ciudad}, ${l.direccion.estado}`,14,86);const P=["Producto","Cantidad","Precio","Total"],Q=[];l.items.forEach(c=>{const $=[c.nombre,c.cantidad,`$${y(c.precio)}`,`$${y(c.precio*c.cantidad)}`];Q.push($)}),t.autoTable({head:[P],body:Q,startY:100,theme:"striped",headStyles:{fillColor:[41,128,185],textColor:255}});const D=t.lastAutoTable.finalY+10;t.text(`Subtotal: $${y(l.subtotal)}`,130,D,{align:"right"}),l.descuento>0&&t.text(`Descuento: -$${y(l.descuento)}`,130,D+8,{align:"right"}),t.text(`Envío: $${y(l.envio)}`,130,D+16,{align:"right"}),t.text(`Total: $${y(l.total)}`,130,D+24,{align:"right"}),t.setFontSize(10),t.text("Este documento es un comprobante de compra y no tiene validez fiscal.",105,280,{align:"center"}),t.save(`factura_pedido_${l.id}.pdf`),b.notify({message:"Factura descargada correctamente",color:"positive",icon:"check"})})}).catch(e=>{console.error("Error al cargar las librerías de PDF:",e),b.notify({message:"No se pudo generar la factura PDF",color:"negative",icon:"error"})})}catch(e){console.error("Error al generar factura PDF:",e),b.notify({message:"Error al generar la factura",color:"negative",icon:"error"})}};return(l,e)=>(i(),v(be,{padding:""},{default:o(()=>[n("div",Ee,[n("div",Ce,[a(q,{class:"q-mb-md"},{default:o(()=>[a(x,null,{default:o(()=>e[12]||(e[12]=[n("div",{class:"text-h5"},"Mis Pedidos",-1),n("div",{class:"text-caption text-grey"},"Historial de tus compras",-1)])),_:1}),a(h),n("div",Pe,[a(m,{color:s.value==="todos"?"primary":"grey-4","text-color":s.value==="todos"?"white":"grey-8",size:"sm",onClick:e[0]||(e[0]=t=>s.value="todos"),class:S({"text-weight-bold":s.value==="todos"})},{default:o(()=>[e[13]||(e[13]=r(" TODOS ")),p.value.todos>0?(i(),v(C,{key:0,color:s.value==="todos"?"white":"primary","text-color":s.value==="todos"?"primary":"white",class:"q-ml-xs"},{default:o(()=>[r(d(p.value.todos),1)]),_:1},8,["color","text-color"])):_("",!0)]),_:1},8,["color","text-color","class"]),a(m,{color:s.value==="pendiente"?"warning":"grey-4","text-color":s.value==="pendiente"?"white":"grey-8",size:"sm",onClick:e[1]||(e[1]=t=>s.value="pendiente"),class:S({"text-weight-bold":s.value==="pendiente"})},{default:o(()=>[e[14]||(e[14]=r(" PENDIENTES ")),p.value.pendiente>0?(i(),v(C,{key:0,color:s.value==="pendiente"?"white":"warning","text-color":s.value==="pendiente"?"warning":"white",class:"q-ml-xs"},{default:o(()=>[r(d(p.value.pendiente),1)]),_:1},8,["color","text-color"])):_("",!0)]),_:1},8,["color","text-color","class"]),a(m,{color:s.value==="en-proceso"?"secondary":"grey-4","text-color":s.value==="en-proceso"?"white":"grey-8",size:"sm",onClick:e[2]||(e[2]=t=>s.value="en-proceso"),class:S({"text-weight-bold":s.value==="en-proceso"})},{default:o(()=>[e[15]||(e[15]=r(" EN PROCESO ")),p.value.enProceso>0?(i(),v(C,{key:0,color:s.value==="en-proceso"?"white":"secondary","text-color":s.value==="en-proceso"?"secondary":"white",class:"q-ml-xs"},{default:o(()=>[r(d(p.value.enProceso),1)]),_:1},8,["color","text-color"])):_("",!0)]),_:1},8,["color","text-color","class"]),a(m,{color:s.value==="enviado"?"info":"grey-4","text-color":s.value==="enviado"?"white":"grey-8",size:"sm",onClick:e[3]||(e[3]=t=>s.value="enviado"),class:S({"text-weight-bold":s.value==="enviado"})},{default:o(()=>[e[16]||(e[16]=r(" ENVIADOS ")),p.value.enviado>0?(i(),v(C,{key:0,color:s.value==="enviado"?"white":"info","text-color":s.value==="enviado"?"info":"white",class:"q-ml-xs"},{default:o(()=>[r(d(p.value.enviado),1)]),_:1},8,["color","text-color"])):_("",!0)]),_:1},8,["color","text-color","class"]),a(m,{color:s.value==="entregado"?"positive":"grey-4","text-color":s.value==="entregado"?"white":"grey-8",size:"sm",onClick:e[4]||(e[4]=t=>s.value="entregado"),class:S({"text-weight-bold":s.value==="entregado"})},{default:o(()=>[e[17]||(e[17]=r(" ENTREGADOS ")),p.value.entregado>0?(i(),v(C,{key:0,color:s.value==="entregado"?"white":"positive","text-color":s.value==="entregado"?"positive":"white",class:"q-ml-xs"},{default:o(()=>[r(d(p.value.entregado),1)]),_:1},8,["color","text-color"])):_("",!0)]),_:1},8,["color","text-color","class"]),a(m,{color:s.value==="cancelado"?"negative":"grey-4","text-color":s.value==="cancelado"?"white":"grey-8",size:"sm",onClick:e[5]||(e[5]=t=>s.value="cancelado"),class:S({"text-weight-bold":s.value==="cancelado"})},{default:o(()=>[e[18]||(e[18]=r(" CANCELADOS ")),p.value.cancelado>0?(i(),v(C,{key:0,color:s.value==="cancelado"?"white":"negative","text-color":s.value==="cancelado"?"negative":"white",class:"q-ml-xs"},{default:o(()=>[r(d(p.value.cancelado),1)]),_:1},8,["color","text-color"])):_("",!0)]),_:1},8,["color","text-color","class"])]),a(h),N.value?(i(),v(x,{key:0},{default:o(()=>[n("div",ke,[a(fe,{color:"primary",size:"3em"})])]),_:1})):U.value.length===0?(i(),v(x,{key:1},{default:o(()=>[n("div",$e,[a(me,{name:"shopping_bag",size:"4em",color:"grey-5"}),n("div",qe,"No tienes pedidos "+d(Z.value),1),e[19]||(e[19]=n("div",{class:"text-body2 text-grey q-mt-sm"}," Cuando realices una compra, tus pedidos aparecerán aquí. ",-1)),a(m,{color:"primary",label:"Ir a la tienda",class:"q-mt-md",to:"/",icon:"shopping_cart"})])]),_:1})):(i(),v(x,{key:2},{default:o(()=>[a(V,{separator:""},{default:o(()=>[(i(!0),L(G,null,Y(U.value,t=>(i(),v(w,{key:t.id,clickable:"",onClick:P=>oe(t),class:"q-py-md"},{default:o(()=>[a(f,null,{default:o(()=>[a(g,{class:"text-subtitle1"},{default:o(()=>[r(" Pedido #"+d(t.id),1)]),_:2},1024),a(g,{caption:""},{default:o(()=>[r(d(R(t.fecha)),1)]),_:2},1024),n("div",De,[n("div",he,[a(C,{color:M(t.estado)},{default:o(()=>[r(d(t.estado),1)]),_:2},1032,["color"])]),n("div",Se,[n("span",Ve," $"+d(y(t.total)),1)])]),t.estado!=="Cancelado"?(i(),L("div",Ie,[a(ge,{value:ae(t.estado),color:M(t.estado),class:"q-mt-xs"},null,8,["value","color"])])):_("",!0)]),_:2},1024),a(f,{side:""},{default:o(()=>[a(m,{flat:"",round:"",color:"primary",icon:"visibility"},{default:o(()=>[a(pe,null,{default:o(()=>e[20]||(e[20]=[r("Ver detalles")])),_:1})]),_:1})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}))]),_:1})])]),a(K,{modelValue:j.value,"onUpdate:modelValue":e[8]||(e[8]=t=>j.value=t),maximized:""},{default:o(()=>[a(q,null,{default:o(()=>[a(x,{class:"row items-center"},{default:o(()=>{var t;return[n("div",Qe,"Detalles del Pedido #"+d((t=u.value)==null?void 0:t.id),1),a(H),F(a(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[z]])]}),_:1}),a(h),u.value?(i(),v(x,{key:0},{default:o(()=>[n("div",Le,[n("div",Fe,[a(q,{flat:"",bordered:""},{default:o(()=>[a(x,null,{default:o(()=>[e[25]||(e[25]=n("div",{class:"text-subtitle1"},"Información del Pedido",-1)),a(V,{dense:""},{default:o(()=>{var t;return[a(w,null,{default:o(()=>[a(f,null,{default:o(()=>[a(g,{caption:""},{default:o(()=>e[21]||(e[21]=[r("Fecha")])),_:1}),a(g,null,{default:o(()=>[r(d(R(u.value.fecha)),1)]),_:1})]),_:1})]),_:1}),a(w,null,{default:o(()=>[a(f,null,{default:o(()=>[a(g,{caption:""},{default:o(()=>e[22]||(e[22]=[r("Estado")])),_:1}),a(g,null,{default:o(()=>[a(C,{color:M(u.value.estado)},{default:o(()=>[r(d(u.value.estado),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),a(w,null,{default:o(()=>[a(f,null,{default:o(()=>[a(g,{caption:""},{default:o(()=>e[23]||(e[23]=[r("Método de pago")])),_:1}),a(g,null,{default:o(()=>[r(d(u.value.metodoPago),1)]),_:1})]),_:1})]),_:1}),(t=u.value.detallesPago)!=null&&t.idTransaccion?(i(),v(w,{key:0},{default:o(()=>[a(f,null,{default:o(()=>[a(g,{caption:""},{default:o(()=>e[24]||(e[24]=[r("ID de Transacción")])),_:1}),a(g,null,{default:o(()=>[r(d(u.value.detallesPago.idTransaccion),1)]),_:1})]),_:1})]),_:1})):_("",!0)]}),_:1})]),_:1})]),_:1}),a(q,{flat:"",bordered:"",class:"q-mt-md"},{default:o(()=>[a(x,null,{default:o(()=>[e[26]||(e[26]=n("div",{class:"text-subtitle1"},"Dirección de Envío",-1)),a(V,{dense:""},{default:o(()=>[a(w,null,{default:o(()=>[a(f,null,{default:o(()=>[a(g,null,{default:o(()=>[r(d(u.value.direccion.calle),1)]),_:1}),a(g,{caption:""},{default:o(()=>[r(d(u.value.direccion.ciudad)+", "+d(u.value.direccion.estado),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),n("div",ze,[a(q,{flat:"",bordered:""},{default:o(()=>[a(x,null,{default:o(()=>[e[31]||(e[31]=n("div",{class:"text-subtitle1"},"Resumen",-1)),a(V,{dense:""},{default:o(()=>[a(w,null,{default:o(()=>[a(f,null,{default:o(()=>e[27]||(e[27]=[r("Subtotal")])),_:1}),a(f,{side:""},{default:o(()=>[r("$"+d(y(u.value.subtotal)),1)]),_:1})]),_:1}),u.value.descuento>0?(i(),v(w,{key:0},{default:o(()=>[a(f,null,{default:o(()=>e[28]||(e[28]=[r("Descuento")])),_:1}),a(f,{side:"",class:"text-negative"},{default:o(()=>[r("-$"+d(y(u.value.descuento)),1)]),_:1})]),_:1})):_("",!0),a(w,null,{default:o(()=>[a(f,null,{default:o(()=>e[29]||(e[29]=[r("Envío")])),_:1}),a(f,{side:""},{default:o(()=>[r("$"+d(y(u.value.envio)),1)]),_:1})]),_:1}),a(h,{class:"q-my-sm"}),a(w,null,{default:o(()=>[a(f,{class:"text-weight-bold"},{default:o(()=>e[30]||(e[30]=[r("Total")])),_:1}),a(f,{side:"",class:"text-weight-bold"},{default:o(()=>[r("$"+d(y(u.value.total)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(q,{flat:"",bordered:"",class:"q-mt-md"},{default:o(()=>[a(x,null,{default:o(()=>[e[32]||(e[32]=n("div",{class:"text-subtitle1"},"Acciones",-1)),n("div",Ae,[a(m,{color:"primary",icon:"receipt",label:"Descargar Factura",onClick:e[6]||(e[6]=t=>se(u.value))}),u.value.estado==="Pendiente"?(i(),v(m,{key:0,color:"negative",icon:"cancel",label:"Cancelar Pedido",onClick:e[7]||(e[7]=t=>te(u.value))})):_("",!0)])]),_:1})]),_:1})])]),a(h,{class:"q-my-md"}),e[34]||(e[34]=n("div",{class:"text-subtitle1 q-mb-sm"},"Productos",-1)),a(V,{separator:""},{default:o(()=>[(i(!0),L(G,null,Y(u.value.items,(t,P)=>(i(),v(w,{key:P},{default:o(()=>[a(f,{avatar:""},{default:o(()=>[a(ye,{src:t.imagen,"spinner-color":"primary",style:{height:"60px",width:"60px"},class:"rounded-borders"},null,8,["src"])]),_:2},1024),a(f,null,{default:o(()=>[a(g,null,{default:o(()=>[r(d(t.nombre),1)]),_:2},1024),a(g,{caption:""},{default:o(()=>[r(" Cantidad: "+d(t.cantidad)+" ",1),t.color?(i(),L("span",Ne,[e[33]||(e[33]=r(" Color: ")),a(C,{style:xe(`background-color: ${t.color}`)},null,8,["style"])])):_("",!0)]),_:2},1024)]),_:2},1024),a(f,{side:""},{default:o(()=>[n("div",Te," $"+d(y(t.precio*t.cantidad)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):_("",!0),a(J,{align:"right"},{default:o(()=>[F(a(m,{flat:"",label:"Cerrar",color:"primary"},null,512),[[z]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(K,{modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=t=>O.value=t)},{default:o(()=>[a(q,{style:{width:"500px","max-width":"90vw"}},{default:o(()=>[a(x,{class:"row items-center"},{default:o(()=>[e[35]||(e[35]=n("div",{class:"text-h6"},"Valorar tu compra",-1)),a(H),F(a(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[z]])]),_:1}),a(h),a(x,null,{default:o(()=>[n("div",je,[e[36]||(e[36]=n("div",{class:"text-subtitle1 q-mb-sm"},"¿Cómo calificarías tu experiencia?",-1)),a(_e,{modelValue:I.value.puntuacion,"onUpdate:modelValue":e[9]||(e[9]=t=>I.value.puntuacion=t),size:"3em",color:"amber",icon:"star_border","icon-selected":"star",max:5},null,8,["modelValue"])]),a(we,{modelValue:I.value.comentario,"onUpdate:modelValue":e[10]||(e[10]=t=>I.value.comentario=t),label:"Comparte tu opinión (opcional)",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),a(J,{align:"right"},{default:o(()=>[F(a(m,{flat:"",label:"Cancelar",color:"grey"},null,512),[[z]]),T.value?(i(),v(m,{key:1,label:"Enviando...",color:"primary",disable:""})):(i(),v(m,{key:0,flat:"",label:"Enviar valoración",color:"primary",onClick:le}))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Be=re(Oe,[["__scopeId","data-v-1cb0aa0c"]]);export{Be as default};

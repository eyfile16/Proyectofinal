import{_ as M,y as F,a as L,r as u,s as R,W as b,X as y,B as o,A as n,Y as t,Z as U,$ as h,a0 as A,z as W,a1 as G,C as d,a2 as T,a3 as _,a4 as X,v as q,a5 as Y,a6 as Z,a7 as H,a8 as J,a9 as K,aa as O,ab as aa,R as ea,S as g,U as x}from"./index-B47RnTNl.js";const ra={class:"row justify-center"},oa={class:"col-12 col-md-8 col-lg-6"},la={class:"row justify-center q-mb-lg"},ta={class:"column items-center"},sa=["src"],ia=["src"],na=["src"],ua={class:"q-mt-md q-gutter-sm"},ca={class:"row justify-end q-mt-md"},da={class:"row q-col-gutter-md justify-center"},ma=["src","alt"],va={class:"text-caption q-mt-xs"},pa={__name:"Perfil",setup(fa){const i=ea(),m=F(),s=L(()=>m.usuario),v=u(""),p=u(""),P=u(""),f=u(""),k=u(""),z=u(!1),w=u(!1),c=u(""),C=u(null),E=u(!1),I=[{id:"avatar1",nombre:"Casual"},{id:"avatar2",nombre:"Profesional"},{id:"avatar3",nombre:"Deportivo"},{id:"avatar4",nombre:"Elegante"},{id:"avatar5",nombre:"Creativo"}];R(async()=>{if(s.value){v.value=s.value.nombre||"",p.value=s.value.email||"",c.value=s.value.avatarPredeterminado||"avatar1";try{const a=await b.get(`/api/usuarios/${s.value._id}`);a.data&&(m.setUser(a.data),v.value=a.data.nombre||"",p.value=a.data.email||"",c.value=a.data.avatarPredeterminado||"avatar1")}catch(a){console.warn("No se pudieron cargar los datos actualizados del usuario:",a)}}});const V=a=>`/avatars/${a}.svg`,Q=()=>{var a;c.value=((a=s.value)==null?void 0:a.avatarPredeterminado)||"avatar1",w.value=!0},B=()=>{var a;(a=C.value)==null||a.click()},N=async a=>{const r=a.target.files[0];if(r){if(!r.type.startsWith("image/")){i.notify({color:"negative",message:"Por favor selecciona un archivo de imagen válido",icon:"error"});return}if(r.size>5*1024*1024){i.notify({color:"negative",message:"La imagen debe ser menor a 5MB",icon:"error"});return}try{E.value=!0;const l=new FormData;l.append("imagen",r);const e=await b.post("/api/usuarios/subir-imagen",l,{headers:{"Content-Type":"multipart/form-data"}});e.data&&e.data.usuario&&(m.setUser(e.data.usuario),i.notify({color:"positive",message:"Imagen de perfil actualizada correctamente",icon:"check"}),console.log("Imagen subida exitosamente:",e.data.usuario.imagenPerfil))}catch(l){console.error("Error al subir imagen:",l),i.notify({color:"negative",message:"Error al subir la imagen",icon:"error"})}finally{E.value=!1,C.value&&(C.value.value="")}}},j=async()=>{try{const a=await b.delete("/api/usuarios/eliminar-imagen");a.data&&a.data.usuario&&(m.setUser(a.data.usuario),i.notify({color:"positive",message:"Imagen de perfil eliminada correctamente",icon:"check"}))}catch(a){console.error("Error al eliminar imagen:",a),i.notify({color:"negative",message:"Error al eliminar la imagen",icon:"error"})}},D=async()=>{if(c.value)try{const a=await b.put("/api/usuarios/avatar",{avatarPredeterminado:c.value});a.data&&a.data.usuario&&(m.setUser(a.data.usuario),w.value=!1,i.notify({color:"positive",message:"Avatar actualizado correctamente",icon:"check"}),console.log("Avatar actualizado en el backend:",a.data.usuario.avatarPredeterminado))}catch(a){console.error("Error al actualizar avatar:",a),i.notify({color:"negative",message:"Error al actualizar el avatar",icon:"error"})}},$=async()=>{try{if(z.value=!0,!v.value.trim()||!p.value.trim()){i.notify({color:"negative",message:"Por favor completa todos los campos requeridos",icon:"error"});return}const a=await b.put("/api/usuarios/actualizar",{_id:s.value._id,nombre:v.value.trim(),email:p.value.trim()});a.data&&a.data.usuario&&(m.setUser(a.data.usuario),i.notify({message:"Perfil actualizado correctamente",color:"positive",icon:"check_circle"}),console.log("Perfil actualizado en el backend:",a.data.usuario)),P.value="",f.value="",k.value=""}catch(a){console.error("Error al actualizar perfil:",a),i.notify({message:"Error al actualizar el perfil",color:"negative",icon:"error"})}finally{z.value=!1}};return(a,r)=>(g(),y("div",null,[o(X,{padding:""},{default:n(()=>[t("div",ra,[t("div",oa,[o(U,{class:"q-pa-lg"},{default:n(()=>[o(h,null,{default:n(()=>{var l;return[r[7]||(r[7]=t("div",{class:"text-h5 q-mb-md"},"Mi Perfil",-1)),t("div",la,[t("div",ta,[o(A,{size:"150px",class:"q-mb-sm bg-grey-3"},{default:n(()=>{var e,S;return[(e=s.value)!=null&&e.imagenPerfil?(g(),y("img",{key:0,src:s.value.imagenPerfil,style:{"object-fit":"cover"}},null,8,sa)):(S=s.value)!=null&&S.avatarPredeterminado?(g(),y("img",{key:1,src:V(s.value.avatarPredeterminado)},null,8,ia)):(g(),y("img",{key:2,src:V("avatar1")},null,8,na))]}),_:1}),t("div",ua,[o(d,{color:"primary",label:"Avatares",size:"md",onClick:Q,icon:"face"}),o(d,{color:"secondary",label:"Subir Imagen",size:"md",onClick:B,icon:"photo_camera"}),(l=s.value)!=null&&l.imagenPerfil?(g(),W(d,{key:0,color:"negative",label:"Eliminar",size:"sm",onClick:j,icon:"delete",flat:""})):G("",!0)]),t("input",{ref_key:"fileInput",ref:C,type:"file",accept:"image/*",style:{display:"none"},onChange:N},null,544)])]),o(T,{onSubmit:$,class:"q-gutter-md"},{default:n(()=>[o(_,{modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=e=>v.value=e),label:"Nombre completo",outlined:"",rules:[e=>!!e||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),o(_,{modelValue:p.value,"onUpdate:modelValue":r[1]||(r[1]=e=>p.value=e),label:"Correo electrónico",outlined:"",type:"email",rules:[e=>!!e||"El correo es obligatorio",e=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)||"Correo inválido"]},null,8,["modelValue","rules"]),r[6]||(r[6]=t("div",{class:"text-subtitle1 q-mt-lg"},"Cambiar contraseña",-1)),o(_,{modelValue:P.value,"onUpdate:modelValue":r[2]||(r[2]=e=>P.value=e),label:"Contraseña actual",outlined:"",type:"password",rules:[e=>!e||f.value.length>0&&!!e||"Requerida para cambiar contraseña"]},null,8,["modelValue","rules"]),o(_,{modelValue:f.value,"onUpdate:modelValue":r[3]||(r[3]=e=>f.value=e),label:"Nueva contraseña",outlined:"",type:"password",rules:[e=>!e||e.length>=6||"Mínimo 6 caracteres"]},null,8,["modelValue","rules"]),o(_,{modelValue:k.value,"onUpdate:modelValue":r[4]||(r[4]=e=>k.value=e),label:"Confirmar contraseña",outlined:"",type:"password",rules:[e=>!f.value.length||e===f.value||"Las contraseñas no coinciden"]},null,8,["modelValue","rules"]),t("div",ca,[o(d,{type:"submit",color:"primary",label:"Guardar cambios",loading:z.value},null,8,["loading"])])]),_:1})]}),_:1})]),_:1})])])]),_:1}),o(aa,{modelValue:w.value,"onUpdate:modelValue":r[5]||(r[5]=l=>w.value=l),persistent:""},{default:n(()=>[o(U,{style:{"min-width":"400px"}},{default:n(()=>[o(h,{class:"row items-center q-pb-none"},{default:n(()=>[r[8]||(r[8]=t("div",{class:"text-h6"},"Seleccionar Avatar",-1)),o(Y),q(o(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[x]])]),_:1}),o(h,null,{default:n(()=>[r[9]||(r[9]=t("div",{class:"text-body2 q-mb-md text-grey-7"}," Elige uno de nuestros avatares predeterminados: ",-1)),t("div",da,[(g(),y(Z,null,H(I,l=>t("div",{key:l.id,class:"col-4 text-center"},[o(A,{size:"80px",class:J(["cursor-pointer avatar-option",{"avatar-selected":c.value===l.id}]),onClick:e=>c.value=l.id},{default:n(()=>[t("img",{src:V(l.id),alt:l.nombre},null,8,ma)]),_:2},1032,["class","onClick"]),t("div",va,K(l.nombre),1)])),64))])]),_:1}),o(O,{align:"right"},{default:n(()=>[q(o(d,{flat:"",label:"Cancelar",color:"grey"},null,512),[[x]]),q(o(d,{label:"Seleccionar",color:"primary",onClick:D,disable:!c.value},null,8,["disable"]),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ba=M(pa,[["__scopeId","data-v-ba4d8b62"]]);export{ba as default};
